<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="es"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>DataAccess.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">Proyecto1_bets</a> &gt; <a href="index.source.html" class="el_package">dataAccess</a> &gt; <span class="el_source">DataAccess.java</span></div><h1>DataAccess.java</h1><pre class="source lang-java linenums">package dataAccess;

import java.util.ArrayList;
//hello
import java.util.Calendar;
import java.util.Collection;
import java.util.Date;
import java.util.HashMap;
import java.util.LinkedList;
import java.util.List;
import java.util.Locale;
import java.util.Map;
import java.util.ResourceBundle;
import java.util.Vector;

import javax.persistence.EntityManager;
import javax.persistence.EntityManagerFactory;
import javax.persistence.Persistence;
import javax.persistence.TypedQuery;

import configuration.ConfigXML;
import configuration.UtilDate;
import domain.ApustuAnitza;
import domain.Apustua;

import domain.Event;
import domain.EventParam;
import domain.Jarraitzailea;

import domain.Question;
import domain.Quote;
import domain.Registered;
import domain.Sport;
import domain.Team;
import domain.Transaction;
import exceptions.EventNotFinished;
import exceptions.QuestionAlreadyExist;
import exceptions.QuoteAlreadyExist;

/**
 * It implements the data access to the objectDb database
 */
public class DataAccess  {
	protected static EntityManager  db;
	protected static EntityManagerFactory emf;


<span class="fc" id="L48">	ConfigXML c=ConfigXML.getInstance();</span>

<span class="fc" id="L50">	public DataAccess(boolean initializeMode)  {</span>

<span class="fc" id="L52">		System.out.println(&quot;Creating DataAccess instance =&gt; isDatabaseLocal: &quot;+c.isDatabaseLocal()+&quot; getDatabBaseOpenMode: &quot;+c.getDataBaseOpenMode());</span>

<span class="fc" id="L54">		open(initializeMode);</span>

<span class="fc" id="L56">	}</span>

	public DataAccess()  {	
<span class="fc" id="L59">		this(false);</span>
<span class="fc" id="L60">	}</span>


	/**
	 * This is the data access method that initializes the database with some events and questions.
	 * This method is invoked by the business logic (constructor of BLFacadeImplementation) when the option &quot;initialize&quot; is declared in the tag dataBaseOpenMode of resources/config.xml file
	 */	
	public void initializeDB(){

<span class="nc" id="L69">		db.getTransaction().begin();</span>
		try {


<span class="nc" id="L73">			Calendar today = Calendar.getInstance();</span>

<span class="nc" id="L75">			int month=today.get(Calendar.MONTH);</span>
<span class="nc" id="L76">			month+=1;</span>
<span class="nc" id="L77">			int year=today.get(Calendar.YEAR);</span>
<span class="nc bnc" id="L78" title="All 2 branches missed.">			if (month==12) { month=0; year+=1;}  </span>

<span class="nc" id="L80">			Team team1= new Team(&quot;Atletico&quot;);</span>
<span class="nc" id="L81">			Team team2= new Team(&quot;Athletic&quot;);</span>
<span class="nc" id="L82">			Team team3= new Team(&quot;Eibar&quot;);</span>
<span class="nc" id="L83">			Team team4= new Team(&quot;Barcelona&quot;);</span>
<span class="nc" id="L84">			Team team5= new Team(&quot;Getafe&quot;);</span>
<span class="nc" id="L85">			Team team6= new Team(&quot;Celta&quot;);</span>
<span class="nc" id="L86">			Team team7= new Team(&quot;Alaves&quot;);</span>
<span class="nc" id="L87">			Team team8= new Team(&quot;Deportivo&quot;);</span>
<span class="nc" id="L88">			Team team9= new Team(&quot;Espanol&quot;);</span>
<span class="nc" id="L89">			Team team10= new Team(&quot;Villareal&quot;);</span>
<span class="nc" id="L90">			Team team11= new Team(&quot;Las_Palmas&quot;);</span>
<span class="nc" id="L91">			Team team12= new Team(&quot;Sevilla&quot;);</span>
<span class="nc" id="L92">			Team team13= new Team(&quot;Malaga&quot;);</span>
<span class="nc" id="L93">			Team team14= new Team(&quot;Valencia&quot;);</span>
<span class="nc" id="L94">			Team team15= new Team(&quot;Girona&quot;);</span>
<span class="nc" id="L95">			Team team16= new Team(&quot;Leganes&quot;);</span>
<span class="nc" id="L96">			Team team17= new Team(&quot;Real_Sociedad&quot;);</span>
<span class="nc" id="L97">			Team team18= new Team(&quot;Levante&quot;);</span>
<span class="nc" id="L98">			Team team19= new Team(&quot;Betis&quot;);</span>
<span class="nc" id="L99">			Team team20= new Team(&quot;Real_Madrid&quot;);</span>
<span class="nc" id="L100">			Team team21= new Team(&quot;LA_Lakers&quot;);</span>
<span class="nc" id="L101">			Team team22= new Team(&quot;Phoenix_Suns&quot;);</span>
<span class="nc" id="L102">			Team team23= new Team(&quot;Atlanta_Hawks&quot;);</span>
<span class="nc" id="L103">			Team team24= new Team(&quot;Houston_Rockets&quot;);</span>
<span class="nc" id="L104">			Team team25= new Team(&quot;Miami_Heat&quot;);</span>
<span class="nc" id="L105">			Team team26= new Team(&quot;Chicago_Bulls&quot;);</span>
<span class="nc" id="L106">			Team team27= new Team(&quot;Boston_Celtics&quot;);</span>
<span class="nc" id="L107">			Team team28= new Team(&quot;Memphis_Grizzlies&quot;);</span>
<span class="nc" id="L108">			Team team29= new Team(&quot;Nadal&quot;);</span>
<span class="nc" id="L109">			Team team30= new Team(&quot;Alcaraz&quot;);</span>
<span class="nc" id="L110">			Team team31= new Team(&quot;Djokovic&quot;);</span>
<span class="nc" id="L111">			Team team32= new Team(&quot;Federer&quot;);</span>


<span class="nc" id="L114">			Event ev1=new Event(1, &quot;Atletico-Athletic&quot;, UtilDate.newDate(year,month,17), team1, team2);</span>
<span class="nc" id="L115">			Event ev2=new Event(2, &quot;Eibar-Barcelona&quot;, UtilDate.newDate(year,month,17), team3, team4);</span>
<span class="nc" id="L116">			Event ev3=new Event(3, &quot;Getafe-Celta&quot;, UtilDate.newDate(year,month,17), team5, team6);</span>
<span class="nc" id="L117">			Event ev4=new Event(4, &quot;Alaves-Deportivo&quot;, UtilDate.newDate(year,month,17), team7, team8);</span>
<span class="nc" id="L118">			Event ev5=new Event(5, &quot;Espanol-Villareal&quot;, UtilDate.newDate(year,month,17), team9, team10);</span>
<span class="nc" id="L119">			Event ev6=new Event(6, &quot;Las Palmas-Sevilla&quot;, UtilDate.newDate(year,month,17), team11, team12);</span>
<span class="nc" id="L120">			Event ev7=new Event(7, &quot;Malaga-Valencia&quot;, UtilDate.newDate(year,month,17), team13, team14);</span>
<span class="nc" id="L121">			Event ev8=new Event(8, &quot;Girona-Leganes&quot;, UtilDate.newDate(year,month,17), team15, team16);</span>
<span class="nc" id="L122">			Event ev9=new Event(9, &quot;Real Sociedad-Levante&quot;, UtilDate.newDate(year,month,17), team17, team18);</span>
<span class="nc" id="L123">			Event ev10=new Event(10, &quot;Betis-Real Madrid&quot;, UtilDate.newDate(year,month,17), team19, team20);</span>

<span class="nc" id="L125">			Event ev11=new Event(11, &quot;Atletico-Athletic&quot;, UtilDate.newDate(year,month,1), team1, team2);</span>
<span class="nc" id="L126">			Event ev12=new Event(12, &quot;Eibar-Barcelona&quot;, UtilDate.newDate(year,month,1), team3, team4);</span>
<span class="nc" id="L127">			Event ev13=new Event(13, &quot;Getafe-Celta&quot;, UtilDate.newDate(year,month,1), team5, team6);</span>
<span class="nc" id="L128">			Event ev14=new Event(14, &quot;Alaves-Deportivo&quot;, UtilDate.newDate(year,month,1), team7, team8);</span>
<span class="nc" id="L129">			Event ev15=new Event(15, &quot;Espanol-Villareal&quot;, UtilDate.newDate(year,month,1), team9, team10);</span>
<span class="nc" id="L130">			Event ev16=new Event(16, &quot;Las Palmas-Sevilla&quot;, UtilDate.newDate(year,month,1), team11, team12);</span>


<span class="nc" id="L133">			Event ev17=new Event(17, &quot;Malaga-Valencia&quot;, UtilDate.newDate(year,month+1,28), team13, team14);</span>
<span class="nc" id="L134">			Event ev18=new Event(18, &quot;Girona-Leganes&quot;, UtilDate.newDate(year,month+1,28), team15, team16);</span>
<span class="nc" id="L135">			Event ev19=new Event(19, &quot;Real Sociedad-Levante&quot;, UtilDate.newDate(year,month+1,28), team17, team18);</span>
<span class="nc" id="L136">			Event ev20=new Event(20, &quot;Betis-Real Madrid&quot;, UtilDate.newDate(year,month+1,28), team19, team20);</span>
<span class="nc" id="L137">			Event ev21=new Event(21, &quot;Real Madrid-Barcelona&quot;, UtilDate.newDate(year, month-2, 21), team20, team4);</span>

<span class="nc" id="L139">			Event ev22=new Event(22, &quot;LA Lakers-Phoenix Suns&quot;, UtilDate.newDate(year,month,17), team21, team22);</span>
<span class="nc" id="L140">			Event ev23=new Event(23, &quot;Atlanta Hawks-Houston Rockets&quot;, UtilDate.newDate(year,month,17), team23, team24);</span>
<span class="nc" id="L141">			Event ev24=new Event(24, &quot;Miami Heat-Chicago Bulls&quot;, UtilDate.newDate(year,month,17), team25, team26);</span>
<span class="nc" id="L142">			Event ev25=new Event(25, &quot;Boston Celtics-Memphis Grizzlies&quot;, UtilDate.newDate(year,month,1), team27, team28);</span>

<span class="nc" id="L144">			Event ev26=new Event(26, &quot;Nadal-Alcaraz&quot;, UtilDate.newDate(year,month,1), team29, team30);</span>
<span class="nc" id="L145">			Event ev27=new Event(27, &quot;Djokovic-Federer&quot;, UtilDate.newDate(year,month,17), team31, team32);</span>

<span class="nc" id="L147">			Sport sp1=new Sport(&quot;Futbol&quot;);</span>
<span class="nc" id="L148">			Sport sp2=new Sport(&quot;Baloncesto&quot;);</span>
<span class="nc" id="L149">			Sport sp3=new Sport(&quot;Tennis&quot;);</span>

<span class="nc" id="L151">			sp1.addEvent(ev1);</span>
<span class="nc" id="L152">			sp1.addEvent(ev2);</span>
<span class="nc" id="L153">			sp1.addEvent(ev3);</span>
<span class="nc" id="L154">			sp1.addEvent(ev4);</span>
<span class="nc" id="L155">			sp1.addEvent(ev5);</span>
<span class="nc" id="L156">			sp1.addEvent(ev6);</span>
<span class="nc" id="L157">			sp1.addEvent(ev7);</span>
<span class="nc" id="L158">			sp1.addEvent(ev8);</span>
<span class="nc" id="L159">			sp1.addEvent(ev9);</span>
<span class="nc" id="L160">			sp1.addEvent(ev10);</span>
<span class="nc" id="L161">			sp1.addEvent(ev11);</span>
<span class="nc" id="L162">			sp1.addEvent(ev12);</span>
<span class="nc" id="L163">			sp1.addEvent(ev13);</span>
<span class="nc" id="L164">			sp1.addEvent(ev14);</span>
<span class="nc" id="L165">			sp1.addEvent(ev15);</span>
<span class="nc" id="L166">			sp1.addEvent(ev16);</span>
<span class="nc" id="L167">			sp1.addEvent(ev17);</span>
<span class="nc" id="L168">			sp1.addEvent(ev18);</span>
<span class="nc" id="L169">			sp1.addEvent(ev19);</span>
<span class="nc" id="L170">			sp1.addEvent(ev20);</span>
<span class="nc" id="L171">			sp1.addEvent(ev21);</span>
<span class="nc" id="L172">			sp2.addEvent(ev22);</span>
<span class="nc" id="L173">			sp2.addEvent(ev23);</span>
<span class="nc" id="L174">			sp2.addEvent(ev24);</span>
<span class="nc" id="L175">			sp2.addEvent(ev25);</span>
<span class="nc" id="L176">			sp3.addEvent(ev26);</span>
<span class="nc" id="L177">			sp3.addEvent(ev27);</span>

<span class="nc" id="L179">			ev1.setSport(sp1);</span>
<span class="nc" id="L180">			ev2.setSport(sp1);</span>
<span class="nc" id="L181">			ev3.setSport(sp1);</span>
<span class="nc" id="L182">			ev4.setSport(sp1);</span>
<span class="nc" id="L183">			ev5.setSport(sp1);</span>
<span class="nc" id="L184">			ev6.setSport(sp1);</span>
<span class="nc" id="L185">			ev7.setSport(sp1);</span>
<span class="nc" id="L186">			ev8.setSport(sp1);</span>
<span class="nc" id="L187">			ev9.setSport(sp1);</span>
<span class="nc" id="L188">			ev10.setSport(sp1);</span>
<span class="nc" id="L189">			ev11.setSport(sp1);</span>
<span class="nc" id="L190">			ev12.setSport(sp1);</span>
<span class="nc" id="L191">			ev13.setSport(sp1);</span>
<span class="nc" id="L192">			ev14.setSport(sp1);</span>
<span class="nc" id="L193">			ev15.setSport(sp1);</span>
<span class="nc" id="L194">			ev16.setSport(sp1);</span>
<span class="nc" id="L195">			ev17.setSport(sp1);</span>
<span class="nc" id="L196">			ev18.setSport(sp1);</span>
<span class="nc" id="L197">			ev19.setSport(sp1);</span>
<span class="nc" id="L198">			ev20.setSport(sp1);</span>
<span class="nc" id="L199">			ev21.setSport(sp1);</span>
<span class="nc" id="L200">			ev22.setSport(sp2);</span>
<span class="nc" id="L201">			ev23.setSport(sp2);</span>
<span class="nc" id="L202">			ev24.setSport(sp2);</span>
<span class="nc" id="L203">			ev25.setSport(sp2);</span>
<span class="nc" id="L204">			ev26.setSport(sp3);</span>
<span class="nc" id="L205">			ev27.setSport(sp3);</span>

			Question q1;
			Question q2;
			Question q3;
			Question q4;
			Question q5;
			Question q6;
			Question q7;
			Question q8;
			Question q9;
			Question q10;
			Question q11;

<span class="nc" id="L219">			Registered ad1=new Registered(&quot;admin&quot;, &quot;123&quot;, 1234,true);</span>
<span class="nc" id="L220">			Registered reg1 =new Registered(&quot;registered&quot;, &quot;123&quot;, 1234);</span>
<span class="nc" id="L221">			Registered reg2 = new Registered(&quot;andrea&quot;, &quot;123&quot;, 1111);</span>
<span class="nc" id="L222">			Registered reg3 = new Registered(&quot;markel&quot;, &quot;123&quot;, 1111);</span>
<span class="nc" id="L223">			Registered reg4 = new Registered(&quot;mikel&quot;, &quot;123&quot;, 1111);</span>

<span class="nc bnc" id="L225" title="All 2 branches missed.">			if (Locale.getDefault().equals(new Locale(&quot;es&quot;))) {</span>
<span class="nc" id="L226">				final String sus = &quot;Â¿QuiÃ©n ganarÃ¡ el partido?&quot;;</span>
<span class="nc" id="L227">				q1=ev1.addQuestion(sus, 1);</span>
<span class="nc" id="L228">				q2=ev1.addQuestion(&quot;Â¿QuiÃ©n meterÃ¡ el primer gol?&quot;, 2);</span>
<span class="nc" id="L229">				q3=ev11.addQuestion(sus, 1);</span>
<span class="nc" id="L230">				q4=ev11.addQuestion(&quot;Â¿CuÃ¡ntos goles se marcarÃ¡n?&quot;, 2);</span>
<span class="nc" id="L231">				q5=ev17.addQuestion(sus, 1);</span>
<span class="nc" id="L232">				q6=ev17.addQuestion(&quot;Â¿HabrÃ¡ goles en la primera parte?&quot;, 2);</span>

<span class="nc" id="L234">			}</span>
<span class="nc bnc" id="L235" title="All 2 branches missed.">			else if (Locale.getDefault().equals(new Locale(&quot;en&quot;))) {</span>
<span class="nc" id="L236">				q1=ev1.addQuestion(&quot;Who will win the match?&quot;,1);</span>
<span class="nc" id="L237">				q2=ev1.addQuestion(&quot;Who will score first?&quot;,2);</span>
<span class="nc" id="L238">				q3=ev11.addQuestion(&quot;Who will win the match?&quot;,1);</span>
<span class="nc" id="L239">				q4=ev11.addQuestion(&quot;How many goals will be scored in the match?&quot;,2);</span>
<span class="nc" id="L240">				q5=ev17.addQuestion(&quot;Who will win the match?&quot;,1);</span>
<span class="nc" id="L241">				q6=ev17.addQuestion(&quot;Will there be goals in the first half?&quot;,2);</span>

			}			
			else {
<span class="nc" id="L245">				q1=ev1.addQuestion(&quot;Zeinek irabaziko du partidua?&quot;,1);</span>
<span class="nc" id="L246">				q2=ev1.addQuestion(&quot;Zeinek sartuko du lehenengo gola?&quot;,2);</span>
<span class="nc" id="L247">				q3=ev11.addQuestion(&quot;Zeinek irabaziko du partidua?&quot;,1);</span>
<span class="nc" id="L248">				q4=ev11.addQuestion(&quot;Zenbat gol sartuko dira?&quot;,2);</span>
<span class="nc" id="L249">				q5=ev17.addQuestion(&quot;Zeinek irabaziko du partidua?&quot;,1);</span>
<span class="nc" id="L250">				q6=ev17.addQuestion(&quot;Golak sartuko dira lehenengo zatian?&quot;,2);</span>


			}
<span class="nc" id="L254">			q7 = ev21.addQuestion(&quot;Emaitza?&quot;, 1);</span>
<span class="nc" id="L255">			q8 = ev21.addQuestion(&quot;Emaitza?&quot;, 1);</span>
<span class="nc" id="L256">			q9 = ev22.addQuestion(&quot;Irabazlea?&quot;, 1.5);</span>
<span class="nc" id="L257">			q10 = ev26.addQuestion(&quot;Irabazlea?&quot;, 1.5);</span>
<span class="nc" id="L258">			q11 = ev27.addQuestion(&quot;Zeinek irabaziko du lehenengo set-a&quot;, 3.0);</span>


<span class="nc" id="L261">			Quote quote1 = q1.addQuote(1.3, &quot;1&quot;, q1); </span>
<span class="nc" id="L262">			Quote quote2 = q2.addQuote(2.5, &quot;X&quot;, q2); </span>
<span class="nc" id="L263">			Quote quote3 = q3.addQuote(100.0, &quot;2&quot;, q3);</span>
<span class="nc" id="L264">			Quote quote4 = q7.addQuote(2.5, &quot;2&quot;, q7);</span>
<span class="nc" id="L265">			Quote quote5 = q8.addQuote(2.0, &quot;1&quot;, q8);</span>
<span class="nc" id="L266">			Quote quote6 = q7.addQuote(5.0, &quot;1&quot;, q7);</span>
<span class="nc" id="L267">			Quote quote7 = q9.addQuote(3.0, &quot;1&quot;, q9);</span>
<span class="nc" id="L268">			Quote quote8 = q9.addQuote(1.5, &quot;2&quot;, q9);</span>
<span class="nc" id="L269">			Quote quote9 = q10.addQuote(2.5, &quot;1&quot;, q10);</span>
<span class="nc" id="L270">			Quote quote10 = q10.addQuote(1.6, &quot;2&quot;, q10);</span>
<span class="nc" id="L271">			Quote quote11 =q11.addQuote(2.3, &quot;1&quot;, q11);</span>
<span class="nc" id="L272">			Quote quote12 =q11.addQuote(1.5, &quot;2&quot;, q11);</span>

<span class="nc" id="L274">			ApustuAnitza apA1 = new ApustuAnitza(reg1, 5.0);</span>
<span class="nc" id="L275">			ApustuAnitza apA3 = new ApustuAnitza(reg4, 34.5);</span>
<span class="nc" id="L276">			ApustuAnitza apA4 = new ApustuAnitza(reg2, 14.5);</span>
<span class="nc" id="L277">			ApustuAnitza apA5 = new ApustuAnitza(reg3, 10.0);</span>
<span class="nc" id="L278">			ApustuAnitza apA6 = new ApustuAnitza(reg4, 4.5);</span>
<span class="nc" id="L279">			ApustuAnitza apA7 = new ApustuAnitza(reg1, 6.0);</span>
<span class="nc" id="L280">			ApustuAnitza apA8 = new ApustuAnitza(reg1, 2.5);</span>
<span class="nc" id="L281">			ApustuAnitza apA9 = new ApustuAnitza(reg2, 4.0);</span>
<span class="nc" id="L282">			ApustuAnitza apA10= new ApustuAnitza(reg2, 7.5);</span>
<span class="nc" id="L283">			ApustuAnitza apA11= new ApustuAnitza(reg3, 4.5);</span>
<span class="nc" id="L284">			ApustuAnitza apA12= new ApustuAnitza(reg3, 6.5);</span>
<span class="nc" id="L285">			ApustuAnitza apA13= new ApustuAnitza(reg2, 6.5);</span>

<span class="nc" id="L287">			Apustua ap1 = new Apustua(apA1, quote4);</span>
<span class="nc" id="L288">			Apustua ap2 = new Apustua(apA1, quote1);</span>
<span class="nc" id="L289">			apA1.addApustua(ap2);</span>
<span class="nc" id="L290">			apA1.addApustua(ap1);</span>

<span class="nc" id="L292">			Apustua ap3 = new Apustua(apA3, quote4);</span>
<span class="nc" id="L293">			apA3.addApustua(ap3);</span>

<span class="nc" id="L295">			Apustua ap4 = new Apustua(apA4, quote4);</span>
<span class="nc" id="L296">			apA4.addApustua(ap4);</span>

<span class="nc" id="L298">			Apustua ap5 = new Apustua(apA5, quote4);</span>
<span class="nc" id="L299">			apA5.addApustua(ap5);</span>

<span class="nc" id="L301">			Apustua ap6 = new Apustua(apA6, quote1);</span>
<span class="nc" id="L302">			Apustua ap13 = new Apustua(apA6, quote2);</span>
<span class="nc" id="L303">			apA6.addApustua(ap6);</span>
<span class="nc" id="L304">			apA6.addApustua(ap13);</span>

<span class="nc" id="L306">			Apustua ap7 = new Apustua(apA7, quote7);</span>
<span class="nc" id="L307">			apA7.addApustua(ap7);</span>

<span class="nc" id="L309">			Apustua ap8 = new Apustua(apA8, quote9);</span>
<span class="nc" id="L310">			apA8.addApustua(ap8);</span>

<span class="nc" id="L312">			Apustua ap9 = new Apustua(apA9, quote8);</span>
<span class="nc" id="L313">			apA9.addApustua(ap9);</span>

<span class="nc" id="L315">			Apustua ap10= new Apustua(apA10, quote10);</span>
<span class="nc" id="L316">			apA10.addApustua(ap10);</span>

<span class="nc" id="L318">			Apustua ap11= new Apustua(apA11, quote10);</span>
<span class="nc" id="L319">			apA11.addApustua(ap11);</span>

<span class="nc" id="L321">			Apustua ap12= new Apustua(apA12, quote11);</span>
<span class="nc" id="L322">			apA12.addApustua(ap12);</span>

<span class="nc" id="L324">			Apustua ap14= new Apustua(apA13, quote8);</span>
<span class="nc" id="L325">			apA13.addApustua(ap14);</span>

<span class="nc" id="L327">			quote4.addApustua(ap1);</span>
<span class="nc" id="L328">			ap1.eguneratuApustuKant(sp1);</span>
<span class="nc" id="L329">			quote1.addApustua(ap1);</span>
<span class="nc" id="L330">			ap1.eguneratuApustuKant(sp1);</span>

<span class="nc" id="L332">			quote4.addApustua(ap3);</span>
<span class="nc" id="L333">			ap3.eguneratuApustuKant(sp1);</span>

<span class="nc" id="L335">			quote4.addApustua(ap4);</span>
<span class="nc" id="L336">			ap4.eguneratuApustuKant(sp1);</span>

<span class="nc" id="L338">			quote4.addApustua(ap5);</span>
<span class="nc" id="L339">			ap5.eguneratuApustuKant(sp1);</span>

<span class="nc" id="L341">			quote1.addApustua(ap6);</span>
<span class="nc" id="L342">			quote2.addApustua(ap6);</span>
<span class="nc" id="L343">			ap6.eguneratuApustuKant(sp1);</span>
<span class="nc" id="L344">			ap6.eguneratuApustuKant(sp1);</span>

<span class="nc" id="L346">			quote7.addApustua(ap7);</span>
<span class="nc" id="L347">			ap7.eguneratuApustuKant(sp2);</span>
<span class="nc" id="L348">			quote8.addApustua(ap9);</span>
<span class="nc" id="L349">			ap9.eguneratuApustuKant(sp2);</span>

<span class="nc" id="L351">			quote9.addApustua(ap8);</span>
<span class="nc" id="L352">			ap8.eguneratuApustuKant(sp3);</span>
<span class="nc" id="L353">			quote10.addApustua(ap10);</span>
<span class="nc" id="L354">			ap10.eguneratuApustuKant(sp3);</span>

<span class="nc" id="L356">			quote10.addApustua(ap11);</span>
<span class="nc" id="L357">			ap11.eguneratuApustuKant(sp3);</span>
<span class="nc" id="L358">			quote11.addApustua(ap12);</span>
<span class="nc" id="L359">			ap12.eguneratuApustuKant(sp3);</span>

<span class="nc" id="L361">			quote8.addApustua(ap14);</span>
<span class="nc" id="L362">			ap14.eguneratuApustuKant(sp2);</span>

<span class="nc" id="L364">			reg1.addApustuAnitza(apA1);</span>








<span class="nc" id="L373">			Transaction t1 = new Transaction(reg1, apA1.getBalioa(), new Date(), &quot;ApustuaEgin&quot;);</span>
<span class="nc" id="L374">			Transaction t3 = new Transaction(reg2, apA4.getBalioa(), new Date(), &quot;ApustuaEgin&quot;);</span>
<span class="nc" id="L375">			Transaction t4 = new Transaction(reg3, apA5.getBalioa(), new Date(), &quot;ApustuaEgin&quot;);</span>
<span class="nc" id="L376">			Transaction t5 = new Transaction(reg4, apA3.getBalioa(), new Date(), &quot;ApustuaEgin&quot;);</span>
<span class="nc" id="L377">			Transaction t6 = new Transaction(reg4, apA6.getBalioa(), new Date(), &quot;ApustuaEgin&quot;);</span>
<span class="nc" id="L378">			Transaction t7 = new Transaction(reg1, apA7.getBalioa(), new Date(), &quot;ApustuaEgin&quot;);</span>
<span class="nc" id="L379">			Transaction t8 = new Transaction(reg1, apA8.getBalioa(), new Date(), &quot;ApustuaEgin&quot;);</span>
<span class="nc" id="L380">			Transaction t9 = new Transaction(reg2, apA9.getBalioa(), new Date(), &quot;ApustuaEgin&quot;);</span>
<span class="nc" id="L381">			Transaction t10 = new Transaction(reg2, apA10.getBalioa(), new Date(), &quot;ApustuaEgin&quot;);</span>
<span class="nc" id="L382">			Transaction t11 = new Transaction(reg3, apA11.getBalioa(), new Date(), &quot;ApustuaEgin&quot;);</span>
<span class="nc" id="L383">			Transaction t12 = new Transaction(reg3, apA12.getBalioa(), new Date(), &quot;ApustuaEgin&quot;);</span>

<span class="nc" id="L385">			reg1.addTransaction(t1);</span>
<span class="nc" id="L386">			reg2.addTransaction(t3);</span>
<span class="nc" id="L387">			reg3.addTransaction(t4);</span>
<span class="nc" id="L388">			reg4.addTransaction(t5);</span>
<span class="nc" id="L389">			reg4.addTransaction(t6);</span>
<span class="nc" id="L390">			reg1.addTransaction(t7);</span>
<span class="nc" id="L391">			reg1.addTransaction(t8);</span>
<span class="nc" id="L392">			reg2.addTransaction(t9);</span>
<span class="nc" id="L393">			reg2.addTransaction(t10);</span>
<span class="nc" id="L394">			reg3.addTransaction(t11);</span>
<span class="nc" id="L395">			reg3.addTransaction(t12);</span>





<span class="nc" id="L401">			team1.addEvent(ev1);</span>
<span class="nc" id="L402">			team2.addEvent(ev1);</span>
<span class="nc" id="L403">			team3.addEvent(ev2);</span>
<span class="nc" id="L404">			team4.addEvent(ev2);</span>
<span class="nc" id="L405">			team5.addEvent(ev3);</span>
<span class="nc" id="L406">			team6.addEvent(ev3);</span>
<span class="nc" id="L407">			team7.addEvent(ev4);</span>
<span class="nc" id="L408">			team8.addEvent(ev4);</span>
<span class="nc" id="L409">			team9.addEvent(ev5);</span>
<span class="nc" id="L410">			team10.addEvent(ev5);</span>
<span class="nc" id="L411">			team11.addEvent(ev6);</span>
<span class="nc" id="L412">			team12.addEvent(ev6);</span>
<span class="nc" id="L413">			team13.addEvent(ev7);</span>
<span class="nc" id="L414">			team14.addEvent(ev7);</span>
<span class="nc" id="L415">			team15.addEvent(ev8);</span>
<span class="nc" id="L416">			team16.addEvent(ev8);</span>
<span class="nc" id="L417">			team17.addEvent(ev9);</span>
<span class="nc" id="L418">			team18.addEvent(ev9);</span>
<span class="nc" id="L419">			team19.addEvent(ev10);</span>
<span class="nc" id="L420">			team20.addEvent(ev10);</span>
<span class="nc" id="L421">			team1.addEvent(ev11);</span>
<span class="nc" id="L422">			team2.addEvent(ev11);</span>
<span class="nc" id="L423">			team3.addEvent(ev12);</span>
<span class="nc" id="L424">			team4.addEvent(ev12);</span>
<span class="nc" id="L425">			team5.addEvent(ev13);</span>
<span class="nc" id="L426">			team6.addEvent(ev13);</span>
<span class="nc" id="L427">			team7.addEvent(ev14);</span>
<span class="nc" id="L428">			team8.addEvent(ev14);</span>
<span class="nc" id="L429">			team9.addEvent(ev15);</span>
<span class="nc" id="L430">			team10.addEvent(ev15);</span>
<span class="nc" id="L431">			team11.addEvent(ev16);</span>
<span class="nc" id="L432">			team12.addEvent(ev16);</span>
<span class="nc" id="L433">			team13.addEvent(ev17);</span>
<span class="nc" id="L434">			team14.addEvent(ev17);</span>
<span class="nc" id="L435">			team15.addEvent(ev18);</span>
<span class="nc" id="L436">			team16.addEvent(ev18);</span>
<span class="nc" id="L437">			team17.addEvent(ev19);</span>
<span class="nc" id="L438">			team18.addEvent(ev19);</span>
<span class="nc" id="L439">			team19.addEvent(ev20);</span>
<span class="nc" id="L440">			team20.addEvent(ev20);</span>
<span class="nc" id="L441">			team20.addEvent(ev21);</span>
<span class="nc" id="L442">			team4.addEvent(ev21);</span>
<span class="nc" id="L443">			team21.addEvent(ev22);</span>
<span class="nc" id="L444">			team22.addEvent(ev22);</span>
<span class="nc" id="L445">			team23.addEvent(ev23);</span>
<span class="nc" id="L446">			team24.addEvent(ev23);</span>
<span class="nc" id="L447">			team25.addEvent(ev24);</span>
<span class="nc" id="L448">			team26.addEvent(ev24);</span>
<span class="nc" id="L449">			team27.addEvent(ev25);</span>
<span class="nc" id="L450">			team28.addEvent(ev25);</span>
<span class="nc" id="L451">			team29.addEvent(ev26);</span>
<span class="nc" id="L452">			team30.addEvent(ev26);</span>
<span class="nc" id="L453">			team31.addEvent(ev27);</span>
<span class="nc" id="L454">			team32.addEvent(ev27);</span>


<span class="nc" id="L457">			db.persist(team1);</span>
<span class="nc" id="L458">			db.persist(team2);</span>
<span class="nc" id="L459">			db.persist(team3);</span>
<span class="nc" id="L460">			db.persist(team4);</span>
<span class="nc" id="L461">			db.persist(team5);</span>
<span class="nc" id="L462">			db.persist(team6);</span>
<span class="nc" id="L463">			db.persist(team7);</span>
<span class="nc" id="L464">			db.persist(team8);</span>
<span class="nc" id="L465">			db.persist(team9);</span>
<span class="nc" id="L466">			db.persist(team10);</span>
<span class="nc" id="L467">			db.persist(team11);</span>
<span class="nc" id="L468">			db.persist(team12);</span>
<span class="nc" id="L469">			db.persist(team13);</span>
<span class="nc" id="L470">			db.persist(team14);</span>
<span class="nc" id="L471">			db.persist(team15);</span>
<span class="nc" id="L472">			db.persist(team16);</span>
<span class="nc" id="L473">			db.persist(team17);</span>
<span class="nc" id="L474">			db.persist(team18);</span>
<span class="nc" id="L475">			db.persist(team19);</span>
<span class="nc" id="L476">			db.persist(team20);</span>
<span class="nc" id="L477">			db.persist(team21);</span>
<span class="nc" id="L478">			db.persist(team22);</span>
<span class="nc" id="L479">			db.persist(team23);</span>
<span class="nc" id="L480">			db.persist(team24);</span>
<span class="nc" id="L481">			db.persist(team25);</span>
<span class="nc" id="L482">			db.persist(team26);</span>
<span class="nc" id="L483">			db.persist(team27);</span>
<span class="nc" id="L484">			db.persist(team28);</span>
<span class="nc" id="L485">			db.persist(team29);</span>
<span class="nc" id="L486">			db.persist(team30);</span>
<span class="nc" id="L487">			db.persist(team31);</span>
<span class="nc" id="L488">			db.persist(team32);</span>

<span class="nc" id="L490">			db.persist(apA1);</span>
<span class="nc" id="L491">			db.persist(apA3);</span>
<span class="nc" id="L492">			db.persist(apA4);</span>
<span class="nc" id="L493">			db.persist(apA5);</span>
<span class="nc" id="L494">			db.persist(apA6);</span>
<span class="nc" id="L495">			db.persist(apA7);</span>
<span class="nc" id="L496">			db.persist(apA8);</span>
<span class="nc" id="L497">			db.persist(apA9);</span>
<span class="nc" id="L498">			db.persist(apA10);</span>
<span class="nc" id="L499">			db.persist(apA11);</span>
<span class="nc" id="L500">			db.persist(apA12);</span>
<span class="nc" id="L501">			db.persist(apA13);</span>

<span class="nc" id="L503">			db.persist(q1);</span>
<span class="nc" id="L504">			db.persist(q2);</span>
<span class="nc" id="L505">			db.persist(q3);</span>
<span class="nc" id="L506">			db.persist(q4);</span>
<span class="nc" id="L507">			db.persist(q5);</span>
<span class="nc" id="L508">			db.persist(q6);</span>
<span class="nc" id="L509">			db.persist(q7);</span>
<span class="nc" id="L510">			db.persist(q8);</span>
<span class="nc" id="L511">			db.persist(q9);</span>
<span class="nc" id="L512">			db.persist(q10);</span>
<span class="nc" id="L513">			db.persist(q11);</span>



<span class="nc" id="L517">			db.persist(ev1);</span>
<span class="nc" id="L518">			db.persist(ev2);</span>
<span class="nc" id="L519">			db.persist(ev3);</span>
<span class="nc" id="L520">			db.persist(ev4);</span>
<span class="nc" id="L521">			db.persist(ev5);</span>
<span class="nc" id="L522">			db.persist(ev6);</span>
<span class="nc" id="L523">			db.persist(ev7);</span>
<span class="nc" id="L524">			db.persist(ev8);</span>
<span class="nc" id="L525">			db.persist(ev9);</span>
<span class="nc" id="L526">			db.persist(ev10);</span>
<span class="nc" id="L527">			db.persist(ev11);</span>
<span class="nc" id="L528">			db.persist(ev12);</span>
<span class="nc" id="L529">			db.persist(ev13);</span>
<span class="nc" id="L530">			db.persist(ev14);</span>
<span class="nc" id="L531">			db.persist(ev15);</span>
<span class="nc" id="L532">			db.persist(ev16);</span>
<span class="nc" id="L533">			db.persist(ev17);</span>
<span class="nc" id="L534">			db.persist(ev18);</span>
<span class="nc" id="L535">			db.persist(ev19);</span>
<span class="nc" id="L536">			db.persist(ev20);		</span>
<span class="nc" id="L537">			db.persist(ev21);</span>
<span class="nc" id="L538">			db.persist(ev22);</span>
<span class="nc" id="L539">			db.persist(ev23);</span>
<span class="nc" id="L540">			db.persist(ev24);</span>
<span class="nc" id="L541">			db.persist(ev25);</span>
<span class="nc" id="L542">			db.persist(ev26);</span>
<span class="nc" id="L543">			db.persist(ev27);</span>

<span class="nc" id="L545">			db.persist(sp1);</span>
<span class="nc" id="L546">			db.persist(sp2);</span>
<span class="nc" id="L547">			db.persist(sp3);</span>

<span class="nc" id="L549">			db.persist(ad1);</span>
<span class="nc" id="L550">			db.persist(reg1);</span>
<span class="nc" id="L551">			db.persist(reg2);</span>
<span class="nc" id="L552">			db.persist(reg3);</span>
<span class="nc" id="L553">			db.persist(reg4);</span>

<span class="nc" id="L555">			db.persist(quote3);</span>
<span class="nc" id="L556">			db.persist(quote2); </span>
<span class="nc" id="L557">			db.persist(quote1); </span>
<span class="nc" id="L558">			db.persist(quote4);</span>
<span class="nc" id="L559">			db.persist(quote5);</span>
<span class="nc" id="L560">			db.persist(quote6);</span>
<span class="nc" id="L561">			db.persist(quote7);</span>
<span class="nc" id="L562">			db.persist(quote8);</span>
<span class="nc" id="L563">			db.persist(quote9);</span>
<span class="nc" id="L564">			db.persist(quote10);</span>
<span class="nc" id="L565">			db.persist(quote11);</span>
<span class="nc" id="L566">			db.persist(quote12);</span>

<span class="nc" id="L568">			db.persist(ap1);</span>
<span class="nc" id="L569">			db.persist(ap2);</span>
<span class="nc" id="L570">			db.persist(ap3);</span>
<span class="nc" id="L571">			db.persist(ap4);</span>
<span class="nc" id="L572">			db.persist(ap5);</span>
<span class="nc" id="L573">			db.persist(ap6);</span>
<span class="nc" id="L574">			db.persist(ap7);</span>
<span class="nc" id="L575">			db.persist(ap8);</span>
<span class="nc" id="L576">			db.persist(ap9);</span>
<span class="nc" id="L577">			db.persist(ap10);</span>
<span class="nc" id="L578">			db.persist(ap11);</span>
<span class="nc" id="L579">			db.persist(ap12);</span>
<span class="nc" id="L580">			db.persist(ap13);</span>
<span class="nc" id="L581">			db.persist(ap14);</span>

<span class="nc" id="L583">			db.persist(t1);</span>
<span class="nc" id="L584">			db.persist(t3);</span>
<span class="nc" id="L585">			db.persist(t4);</span>
<span class="nc" id="L586">			db.persist(t5);</span>
<span class="nc" id="L587">			db.persist(t6);</span>
<span class="nc" id="L588">			db.persist(t7);</span>
<span class="nc" id="L589">			db.persist(t8);</span>
<span class="nc" id="L590">			db.persist(t9);</span>
<span class="nc" id="L591">			db.persist(t10);</span>
<span class="nc" id="L592">			db.persist(t11);</span>
<span class="nc" id="L593">			db.persist(t12);</span>



<span class="nc" id="L597">			db.getTransaction().commit();</span>

<span class="nc" id="L599">			final String diruaSartu = &quot;DiruaSartu&quot;;</span>
<span class="nc" id="L600">			this.DiruaSartu(reg1, 50.0, new Date(), diruaSartu);</span>
<span class="nc" id="L601">			this.DiruaSartu(reg2, 50.0, new Date(), diruaSartu);</span>
<span class="nc" id="L602">			this.DiruaSartu(reg3, 50.0, new Date(), diruaSartu);</span>
<span class="nc" id="L603">			this.DiruaSartu(reg4, 50.0, new Date(), diruaSartu);</span>

<span class="nc" id="L605">			System.out.println(&quot;Db initialized&quot;);</span>
		}
<span class="nc" id="L607">		catch (Exception e){</span>
<span class="nc" id="L608">			e.printStackTrace();</span>
<span class="nc" id="L609">		}</span>
<span class="nc" id="L610">	}</span>

	/**
	 * This method creates a question for an event, with a question text and the minimum bet
	 * 
	 * @param event to which question is added
	 * @param question text of the question
	 * @param betMinimum minimum quantity of the bet
	 * @return the created question, or null, or an exception
	 * @throws QuestionAlreadyExist if the same question already exists for the event
	 */
	public Question createQuestion(Event event, String question, float betMinimum) throws  QuestionAlreadyExist {
<span class="nc" id="L622">		System.out.println(&quot;&gt;&gt; DataAccess: createQuestion=&gt; event= &quot;+event+&quot; question= &quot;+question+&quot; betMinimum=&quot;+betMinimum);</span>

<span class="nc" id="L624">		Event ev = db.find(Event.class, event.getEventNumber());</span>

<span class="nc bnc" id="L626" title="All 2 branches missed.">		if (ev.DoesQuestionExists(question)) throw new QuestionAlreadyExist(ResourceBundle.getBundle(&quot;Etiquetas&quot;).getString(&quot;ErrorQueryAlreadyExist&quot;));</span>

<span class="nc" id="L628">		db.getTransaction().begin();</span>
<span class="nc" id="L629">		Question q = ev.addQuestion(question, betMinimum);</span>
		//db.persist(q);
<span class="nc" id="L631">		db.persist(ev); // db.persist(q) not required when CascadeType.PERSIST is added in questions property of Event class</span>
		// @OneToMany(fetch=FetchType.EAGER, cascade=CascadeType.PERSIST)
<span class="nc" id="L633">		db.getTransaction().commit();</span>
<span class="nc" id="L634">		return q;</span>

	}

	/**
	 * This method retrieves from the database the events of a given date 
	 * 
	 * @param date in which events are retrieved
	 * @return collection of events
	 */
	public Vector&lt;Event&gt; getEvents(Date date) {
<span class="fc" id="L645">		System.out.println(&quot;&gt;&gt; DataAccess: getEvents&quot;);</span>
<span class="fc" id="L646">		Vector&lt;Event&gt; res = new Vector&lt;Event&gt;();	</span>
<span class="fc" id="L647">		TypedQuery&lt;Event&gt; query = db.createQuery(&quot;SELECT ev FROM Event ev WHERE ev.eventDate=?1&quot;,Event.class);   </span>
<span class="fc" id="L648">		query.setParameter(1, date);</span>
<span class="fc" id="L649">		List&lt;Event&gt; events = query.getResultList();</span>
<span class="fc bfc" id="L650" title="All 2 branches covered.">		for (Event ev:events){</span>
<span class="fc" id="L651">			System.out.println(ev.toString());		 </span>
<span class="fc" id="L652">			res.add(ev);</span>
<span class="fc" id="L653">		}</span>
<span class="fc" id="L654">		return res;</span>
	}

	/**
	 * This method retrieves from the database the dates a month for which there are events
	 * 
	 * @param date of the month for which days with events want to be retrieved 
	 * @return collection of dates
	 */
	public Vector&lt;Date&gt; getEventsMonth(Date date) {
<span class="nc" id="L664">		System.out.println(&quot;&gt;&gt; DataAccess: getEventsMonth&quot;);</span>
<span class="nc" id="L665">		Vector&lt;Date&gt; res = new Vector&lt;Date&gt;();	</span>

<span class="nc" id="L667">		Date firstDayMonthDate= UtilDate.firstDayMonth(date);</span>
<span class="nc" id="L668">		Date lastDayMonthDate= UtilDate.lastDayMonth(date);</span>


<span class="nc" id="L671">		TypedQuery&lt;Date&gt; query = db.createQuery(&quot;SELECT DISTINCT ev.eventDate FROM Event ev WHERE ev.eventDate BETWEEN ?1 and ?2&quot;,Date.class);   </span>
<span class="nc" id="L672">		query.setParameter(1, firstDayMonthDate);</span>
<span class="nc" id="L673">		query.setParameter(2, lastDayMonthDate);</span>
<span class="nc" id="L674">		List&lt;Date&gt; dates = query.getResultList();</span>
<span class="nc bnc" id="L675" title="All 2 branches missed.">		for (Date d:dates){</span>
<span class="nc" id="L676">			System.out.println(d.toString());		 </span>
<span class="nc" id="L677">			res.add(d);</span>
<span class="nc" id="L678">		}</span>
<span class="nc" id="L679">		return res;</span>
	}


	public void open(boolean initializeMode){

<span class="fc" id="L685">		System.out.println(&quot;Opening DataAccess instance =&gt; isDatabaseLocal: &quot;+c.isDatabaseLocal()+&quot; getDatabBaseOpenMode: &quot;+c.getDataBaseOpenMode());</span>

<span class="fc" id="L687">		String fileName=c.getDbFilename();</span>
<span class="pc bpc" id="L688" title="1 of 2 branches missed.">		if (initializeMode) {</span>
<span class="nc" id="L689">			fileName=fileName+&quot;;drop&quot;;</span>
<span class="nc" id="L690">			System.out.println(&quot;Deleting the DataBase&quot;);</span>
		}

<span class="pc bpc" id="L693" title="1 of 2 branches missed.">		if (c.isDatabaseLocal()) {</span>
<span class="fc" id="L694">			emf = Persistence.createEntityManagerFactory(&quot;objectdb:&quot;+fileName);</span>
<span class="fc" id="L695">			db = emf.createEntityManager();</span>
		} else {
<span class="nc" id="L697">			Map&lt;String, String&gt; properties = new HashMap&lt;String, String&gt;();</span>
<span class="nc" id="L698">			properties.put(&quot;javax.persistence.jdbc.user&quot;, c.getUser());</span>
<span class="nc" id="L699">			properties.put(&quot;javax.persistence.jdbc.password&quot;, c.getPassword());</span>

<span class="nc" id="L701">			emf = Persistence.createEntityManagerFactory(&quot;objectdb://&quot;+c.getDatabaseNode()+&quot;:&quot;+c.getDatabasePort()+&quot;/&quot;+fileName, properties);</span>

<span class="nc" id="L703">			db = emf.createEntityManager();</span>
		}

<span class="fc" id="L706">	}</span>
	public boolean existQuestion(Event event, String question) {
<span class="nc" id="L708">		System.out.println(&quot;&gt;&gt; DataAccess: existQuestion=&gt; event= &quot;+event+&quot; question= &quot;+question);</span>
<span class="nc" id="L709">		Event ev = db.find(Event.class, event.getEventNumber());</span>
<span class="nc" id="L710">		return ev.DoesQuestionExists(question);</span>

	}

	public Registered isLogin(String username, String password) {
<span class="nc" id="L715">		Registered u = db.find(Registered.class, username);</span>
<span class="nc bnc" id="L716" title="All 2 branches missed.">		if(u!=null) {</span>
<span class="nc bnc" id="L717" title="All 2 branches missed.">			if(u.getPassword().equals(password)) return u;</span>
		}
<span class="nc" id="L719">		return null;</span>
	}

	public boolean isRegister(String username) {
<span class="nc" id="L723">		Registered u = db.find(Registered.class, username); </span>
<span class="nc bnc" id="L724" title="All 2 branches missed.">		return (u!=null);</span>
	}

	public void storeRegistered(String username, String password, Integer bankAccount) {
<span class="fc" id="L728">		db.getTransaction().begin();</span>
<span class="fc" id="L729">		Registered ad = new Registered(username, password, bankAccount);</span>
<span class="fc" id="L730">		db.persist(ad);</span>
<span class="fc" id="L731">		db.getTransaction().commit();</span>
<span class="fc" id="L732">	}</span>

	/*
	 * Crear eventos con los parametros dados. 
	 * Sólamente si no existe el evento, el evento se creará, devolviendo true. De lo contrario, devolverá false.
	 * 
	 * @param description los equipos o jugadores que van a jugar en el evento
	 * @param eventDate la fecha en que se va a celebrar el evento
	 * @param sport el deporte del evento
	 * @return devuelve true si el evento se ha podido crear; devuelve false si el evento no se ha podido crear
	 * 
	 */
	public boolean gertaerakSortu(EventParam params) {
<span class="fc" id="L745">		db.getTransaction().begin();</span>
<span class="fc" id="L746">		Sport spo =db.find(Sport.class, params.sport);</span>
<span class="fc bfc" id="L747" title="All 2 branches covered.">		if(spo!=null) {</span>
<span class="fc bfc" id="L748" title="All 2 branches covered.">			if(gertaerakSortuAuxiliar_LookForDuplicatedEvents(params.eventDate, params.description)) {</span>
<span class="fc" id="L749">				gertaerakSortuAuxiliar(params.description, params.eventDate, spo);</span>

<span class="fc" id="L751">				db.getTransaction().commit();</span>
<span class="fc" id="L752">				return true;</span>
			} else {
<span class="fc" id="L754">				db.getTransaction().commit();</span>
<span class="fc" id="L755">				return false;</span>
			}
		}
<span class="fc" id="L758">		db.getTransaction().commit();</span>
<span class="fc" id="L759">		return false;</span>
	}

	private boolean gertaerakSortuAuxiliar_LookForDuplicatedEvents(Date eventDate, String description) {
<span class="fc" id="L763">		TypedQuery&lt;Event&gt; Equery = db.createQuery(&quot;SELECT e FROM Event e WHERE e.getEventDate() =?1 &quot;,Event.class);</span>
<span class="fc" id="L764">		Equery.setParameter(1, eventDate);</span>
<span class="fc bfc" id="L765" title="All 2 branches covered.">		for(Event ev: Equery.getResultList())</span>
<span class="fc bfc" id="L766" title="All 2 branches covered.">			if(ev.getDescription().equals(description))</span>
<span class="fc" id="L767">				return false;</span>

<span class="fc" id="L769">		return true;</span>
	}

	private void gertaerakSortuAuxiliar(String description, Date eventDate, Sport spo) {
<span class="fc" id="L773">		String[] taldeak = description.split(&quot;-&quot;);</span>
<span class="fc" id="L774">		Team lokala = new Team(taldeak[0]);</span>
<span class="fc" id="L775">		Team kanpokoa = new Team(taldeak[1]);</span>
<span class="fc" id="L776">		Event e = new Event(description, eventDate, lokala, kanpokoa);</span>
<span class="fc" id="L777">		e.setSport(spo);</span>
<span class="fc" id="L778">		spo.addEvent(e);</span>
<span class="fc" id="L779">		db.persist(e);</span>
<span class="fc" id="L780">	}</span>

	public Quote storeQuote(String forecast, Double Quote, Question question) throws QuoteAlreadyExist {
		//System.out.println(&quot;&gt;&gt; DataAccess: createQuestion=&gt; event= &quot;+event+&quot; question= &quot;+question+&quot; betMinimum=&quot;+betMinimum);

<span class="nc" id="L785">		Question q = db.find(Question.class, question.getQuestionNumber());</span>

<span class="nc bnc" id="L787" title="All 2 branches missed.">		if (q.doesQuoteExist(forecast)) throw new QuoteAlreadyExist(&quot;Kuota existitzen da&quot;);</span>

<span class="nc" id="L789">		db.getTransaction().begin();</span>
<span class="nc" id="L790">		Quote quo = q.addQuote(Quote, forecast, q);</span>
<span class="nc" id="L791">		db.persist(quo); // db.persist(q) not required when CascadeType.PERSIST is added in questions property of Event class</span>
		// @OneToMany(fetch=FetchType.EAGER, cascade=CascadeType.PERSIST)
<span class="nc" id="L793">		db.getTransaction().commit();</span>
<span class="nc" id="L794">		return quo;</span>

	}

	public void close(){
<span class="fc" id="L799">		db.close();</span>
<span class="fc" id="L800">		System.out.println(&quot;DataBase closed&quot;);</span>
<span class="fc" id="L801">	}</span>

	public Sport findSport(Event q){
<span class="nc" id="L804">		Event sp = db.find(Event.class, q.getEventNumber());</span>
<span class="nc" id="L805">		return sp.getSport(); </span>
	}

	public Event findEvent(Quote q){
<span class="nc" id="L809">		Quote quo = db.find(Quote.class, q.getQuoteNumber());</span>
<span class="nc" id="L810">		return quo.getQuestion().getEvent(); </span>
	}

	public Team findTeam(Registered u){
<span class="nc" id="L814">		Registered user = (Registered) db.find(Registered.class, u.getUsername());</span>
<span class="nc" id="L815">		return user.getTaldea(); </span>
	}

	public Event findEventFromApustua(Apustua q){
<span class="nc" id="L819">		Apustua quo = db.find(Apustua.class, q.getApostuaNumber());</span>
<span class="nc" id="L820">		return quo.getKuota().getQuestion().getEvent(); </span>
	}

	public Question findQuestionFromQuote(Quote q){
<span class="nc" id="L824">		Quote quo = db.find(Quote.class, q.getQuoteNumber());</span>
<span class="nc" id="L825">		return quo.getQuestion(); </span>
	}

	public Collection&lt;Question&gt; findQuestion(Event event){
<span class="nc" id="L829">		TypedQuery&lt;Question&gt; Qquery = db.createQuery(&quot;SELECT q FROM Question q WHERE q.getEvent() =?1 &quot;,Question.class);</span>
<span class="nc" id="L830">		Qquery.setParameter(1, event);</span>
<span class="nc" id="L831">		return Qquery.getResultList();</span>
	}

	public Collection&lt;Quote&gt; findQuote(Question question){
<span class="nc" id="L835">		TypedQuery&lt;Quote&gt; Qquery = db.createQuery(&quot;SELECT q FROM Quote q WHERE q.getQuestion() =?1 &quot;,Quote.class);</span>
<span class="nc" id="L836">		Qquery.setParameter(1, question);</span>
<span class="nc" id="L837">		return Qquery.getResultList();</span>
	}

	public void DiruaSartu(Registered u, Double dirua, Date data, String mota) {
<span class="nc" id="L841">		Registered user = (Registered) db.find(Registered.class, u.getUsername()); </span>
<span class="nc" id="L842">		db.getTransaction().begin();</span>
<span class="nc" id="L843">		Transaction t = new Transaction(user, dirua, data, mota); </span>
<span class="nc" id="L844">		System.out.println(t.getMota());</span>
<span class="nc" id="L845">		user.addTransaction(t);</span>
<span class="nc" id="L846">		user.updateDiruKontua(dirua);</span>
<span class="nc" id="L847">		db.persist(t);</span>
<span class="nc" id="L848">		db.getTransaction().commit();</span>
<span class="nc" id="L849">	}</span>

	   public boolean ApustuaEgin(Registered u, Vector&lt;Quote&gt; quote, Double balioa, Integer apustuBikoitzaGalarazi) {
<span class="nc" id="L852">	        Registered user = (Registered) db.find(Registered.class, u.getUsername());</span>
<span class="nc bnc" id="L853" title="All 2 branches missed.">	        if(user.getDirukop()&gt;=balioa) {</span>
<span class="nc" id="L854">	            ApustuAnitza apustuAnitza = auxFTApustuaEgin(user, balioa, quote);</span>
<span class="nc" id="L855">	            db.getTransaction().begin();</span>
<span class="nc bnc" id="L856" title="All 2 branches missed.">	            if(apustuBikoitzaGalarazi==-1) {</span>
<span class="nc" id="L857">	                apustuBikoitzaGalarazi=apustuAnitza.getApustuAnitzaNumber();</span>
	            }
<span class="nc" id="L859">	            apustuAnitza.setApustuKopia(apustuBikoitzaGalarazi);</span>
<span class="nc" id="L860">	            user.updateDiruKontua(-balioa);</span>
<span class="nc" id="L861">	            Transaction t = new Transaction(user, balioa, new Date(), &quot;ApustuaEgin&quot;); </span>
<span class="nc" id="L862">	            user.addApustuAnitza(apustuAnitza);</span>
<span class="nc" id="L863">	            auxFor1(apustuAnitza);</span>
<span class="nc" id="L864">	            user.addTransaction(t);</span>
<span class="nc" id="L865">	            db.persist(t);</span>
<span class="nc" id="L866">	            db.getTransaction().commit();</span>
	            
<span class="nc" id="L868">	            auxFors(user, balioa, quote, apustuBikoitzaGalarazi);</span>
<span class="nc" id="L869">	            return true; </span>
	        }else{
<span class="nc" id="L871">	            return false; </span>
	        }
	        
	    }
	   
	   private ApustuAnitza auxFTApustuaEgin(Registered user, Double balioa, Vector&lt;Quote&gt; quote) {        
<span class="nc" id="L877">	        db.getTransaction().begin();</span>
<span class="nc" id="L878">	        ApustuAnitza apustuAnitza = new ApustuAnitza(user, balioa);</span>
<span class="nc" id="L879">	        db.persist(apustuAnitza);</span>
<span class="nc bnc" id="L880" title="All 2 branches missed.">	        for(Quote quo: quote) {</span>
<span class="nc" id="L881">	            Quote kuote = db.find(Quote.class, quo.getQuoteNumber());</span>
<span class="nc" id="L882">	            Apustua ap = new Apustua(apustuAnitza, kuote);</span>
<span class="nc" id="L883">	            db.persist(ap);</span>
<span class="nc" id="L884">	            apustuAnitza.addApustua(ap);</span>
<span class="nc" id="L885">	            kuote.addApustua(ap);</span>
<span class="nc" id="L886">	        }</span>
<span class="nc" id="L887">	        db.getTransaction().commit();</span>
	        
<span class="nc" id="L889">	        return apustuAnitza;</span>
	    }
	   
	   private void auxFor1(ApustuAnitza apustuAnitza) {
<span class="nc bnc" id="L893" title="All 2 branches missed.">	        for(Apustua a: apustuAnitza.getApustuak()) {</span>
<span class="nc" id="L894">	            Apustua apu = db.find(Apustua.class, a.getApostuaNumber());</span>
<span class="nc" id="L895">	            Quote q = db.find(Quote.class, apu.getKuota().getQuoteNumber());</span>
<span class="nc" id="L896">	            Sport spo =q.getQuestion().getEvent().getSport();</span>
<span class="nc" id="L897">	            spo.setApustuKantitatea(spo.getApustuKantitatea()+1);        </span>
<span class="nc" id="L898">	        }</span>
<span class="nc" id="L899">	    }</span>
	    
	    private void auxFors(Registered user, Double balioa, Vector&lt;Quote&gt; quote, Integer apustuBikoitzaGalarazi) {
	        Boolean b;
<span class="nc" id="L903">	        ApustuAnitza apustuAnitza = auxFTApustuaEgin(user, balioa, quote);</span>
<span class="nc bnc" id="L904" title="All 2 branches missed.">	        for(Jarraitzailea reg:user.getJarraitzaileLista()) {</span>
<span class="nc" id="L905">	            Jarraitzailea erab=db.find(Jarraitzailea.class, reg.getJarraitzaileaNumber());</span>
<span class="nc" id="L906">	            b=true;</span>
<span class="nc bnc" id="L907" title="All 2 branches missed.">	            for(ApustuAnitza apu: erab.getNork().getApustuAnitzak()) {</span>
<span class="nc bnc" id="L908" title="All 2 branches missed.">	                if(apu.getApustuKopia()==apustuAnitza.getApustuKopia()) {</span>
<span class="nc" id="L909">	                    b=false;</span>
	                }
<span class="nc" id="L911">	            }</span>
<span class="nc bnc" id="L912" title="All 2 branches missed.">	            if(b) {</span>
<span class="nc bnc" id="L913" title="All 2 branches missed.">	                if(erab.getNork().getDiruLimitea()&lt;balioa) {</span>
<span class="nc" id="L914">	                    this.ApustuaEgin(erab.getNork(), quote, erab.getNork().getDiruLimitea(), apustuBikoitzaGalarazi);</span>
	                }else{
<span class="nc" id="L916">	                    this.ApustuaEgin(erab.getNork(), quote, balioa, apustuBikoitzaGalarazi);</span>
	                }
	            }
<span class="nc" id="L919">	        }</span>
<span class="nc" id="L920">	    }</span>

	    public void apustuaEzabatu(Registered user1, ApustuAnitza ap) {
<span class="nc" id="L923">	        Registered user = (Registered) db.find(Registered.class, user1.getUsername());</span>
<span class="nc" id="L924">	        ApustuAnitza apustuAnitza = db.find(ApustuAnitza.class, ap.getApustuAnitzaNumber());</span>
<span class="nc" id="L925">	        db.getTransaction().begin();</span>
<span class="nc" id="L926">	        user.updateDiruKontua(apustuAnitza.getBalioa());</span>
<span class="nc" id="L927">	        Transaction t = new Transaction(user, apustuAnitza.getBalioa(), new Date(), &quot;ApustuaEzabatu&quot;);</span>
<span class="nc" id="L928">	        user.addTransaction(t);</span>
<span class="nc" id="L929">	        db.persist(t);</span>
<span class="nc" id="L930">	        user.removeApustua(apustuAnitza);</span>
<span class="nc" id="L931">	        auxApustuaEzabatu(apustuAnitza);</span>
<span class="nc" id="L932">	        db.remove(apustuAnitza);</span>
<span class="nc" id="L933">	        db.getTransaction().commit();</span>
<span class="nc" id="L934">	    }</span>
	    
	    private static void auxApustuaEzabatu(ApustuAnitza apustuAnitza) {
<span class="nc bnc" id="L937" title="All 2 branches missed.">	        for(int i=0; i&lt;apustuAnitza.getApustuak().size(); i++) {</span>
<span class="nc" id="L938">	            apustuAnitza.getApustuak().get(i).getKuota().removeApustua(apustuAnitza.getApustuak().get(i));</span>
<span class="nc" id="L939">	            Sport spo = apustuAnitza.getApustuak().get(i).getKuota().getQuestion().getEvent().getSport();</span>
<span class="nc" id="L940">	            spo.setApustuKantitatea(spo.getApustuKantitatea()-1);</span>
	        }
<span class="nc" id="L942">	    }</span>

	public List&lt;Apustua&gt; findApustua(Registered u){
<span class="nc" id="L945">		Registered user = (Registered) db.find(Registered.class, u.getUsername()); </span>
<span class="nc" id="L946">		TypedQuery&lt;Apustua&gt; Aquery = db.createQuery(&quot;SELECT a FROM Apustua a WHERE a.getUser().getUsername() =?1 &quot;, Apustua.class);</span>
<span class="nc" id="L947">		Aquery.setParameter(1, u.getUsername());</span>
<span class="nc" id="L948">		return Aquery.getResultList();</span>
	}
	public List&lt;ApustuAnitza&gt; findApustuAnitza(Registered u){
<span class="nc" id="L951">		Registered user = (Registered) db.find(Registered.class, u.getUsername()); </span>
<span class="nc" id="L952">		TypedQuery&lt;ApustuAnitza&gt; Aquery = db.createQuery(&quot;SELECT aa FROM ApustuAnitza aa WHERE aa.getUser().getUsername() =?1 &quot;, ApustuAnitza.class);</span>
<span class="nc" id="L953">		Aquery.setParameter(1, u.getUsername());</span>
<span class="nc" id="L954">		return Aquery.getResultList();</span>
	}

	public List&lt;Transaction&gt; findTransakzioak(Registered u){
<span class="nc" id="L958">		Registered user = (Registered) db.find(Registered.class, u.getUsername()); </span>
<span class="nc" id="L959">		TypedQuery&lt;Transaction&gt; Tquery = db.createQuery(&quot;SELECT t FROM Transaction t WHERE t.getErabiltzailea().getUsername() =?1 &quot;, Transaction.class);</span>
<span class="nc" id="L960">		Tquery.setParameter(1, u.getUsername());</span>
<span class="nc" id="L961">		return Tquery.getResultList();</span>

	}

	public void ApustuaIrabazi(ApustuAnitza apustua) {
<span class="nc" id="L966">		ApustuAnitza apustuAnitza = db.find(ApustuAnitza.class, apustua.getApustuAnitzaNumber());</span>
<span class="nc" id="L967">		Registered reg = (Registered) apustuAnitza.getUser();</span>
<span class="nc" id="L968">		Registered r = (Registered) db.find(Registered.class, reg.getUsername());</span>
<span class="nc" id="L969">		db.getTransaction().begin();</span>
<span class="nc" id="L970">		apustuAnitza.setEgoera(&quot;irabazita&quot;);</span>
<span class="nc" id="L971">		Double d=apustuAnitza.getBalioa();</span>
<span class="nc bnc" id="L972" title="All 2 branches missed.">		for(Apustua ap: apustuAnitza.getApustuak()) {</span>
<span class="nc" id="L973">			d = d*ap.getKuota().getQuote();</span>
<span class="nc" id="L974">		}</span>
<span class="nc" id="L975">		r.updateDiruKontua(d);</span>
<span class="nc" id="L976">		r.setIrabazitakoa(r.getIrabazitakoa()+d);</span>
<span class="nc" id="L977">		r.setZenbat(r.getZenbat()+1);</span>
<span class="nc" id="L978">		Transaction t = new Transaction(r, d, new Date(), &quot;ApustuaIrabazi&quot;); </span>
<span class="nc" id="L979">		db.persist(t);</span>
<span class="nc" id="L980">		db.getTransaction().commit();</span>
<span class="nc" id="L981">	}</span>

	public void EmaitzakIpini(Quote quote) throws EventNotFinished{

<span class="nc" id="L985">		Quote q = db.find(Quote.class, quote); </span>
<span class="nc" id="L986">		String result = q.getForecast();</span>

<span class="nc bnc" id="L988" title="All 2 branches missed.">		if(new Date().compareTo(q.getQuestion().getEvent().getEventDate())&lt;0)</span>
<span class="nc" id="L989">			throw new EventNotFinished();</span>

<span class="nc" id="L991">		Vector&lt;Apustua&gt; listApustuak = q.getApustuak();</span>
<span class="nc" id="L992">		db.getTransaction().begin();</span>
<span class="nc" id="L993">		Question que = q.getQuestion(); </span>
<span class="nc" id="L994">		Question question = db.find(Question.class, que); </span>
<span class="nc" id="L995">		question.setResult(result);</span>
<span class="nc" id="L996">		galdutaMarkatuRefact(question);</span>
<span class="nc" id="L997">		db.getTransaction().commit();</span>
<span class="nc bnc" id="L998" title="All 2 branches missed.">		for(Apustua a : listApustuak) {</span>
<span class="nc" id="L999">			db.getTransaction().begin();</span>
<span class="nc" id="L1000">			Boolean bool=a.getApustuAnitza().irabazitaMarkatu();</span>
<span class="nc" id="L1001">			db.getTransaction().commit();</span>
<span class="nc bnc" id="L1002" title="All 2 branches missed.">			if(bool) {</span>
<span class="nc" id="L1003">				this.ApustuaIrabazi(a.getApustuAnitza());</span>
			}
<span class="nc" id="L1005">		}</span>
<span class="nc" id="L1006">	}</span>

	private void galdutaMarkatuRefact(Question question) {
<span class="nc bnc" id="L1009" title="All 2 branches missed.">		for(Quote quo: question.getQuotes()) {</span>
<span class="nc bnc" id="L1010" title="All 2 branches missed.">			for(Apustua apu: quo.getApustuak()) {</span>

<span class="nc" id="L1012">				Boolean b=apu.galdutaMarkatu(quo);</span>
<span class="nc bnc" id="L1013" title="All 2 branches missed.">				if(b) {</span>
<span class="nc" id="L1014">					apu.getApustuAnitza().setEgoera(&quot;galduta&quot;);</span>
				}else {
<span class="nc" id="L1016">					apu.setEgoera(&quot;irabazita&quot;);</span>
				}
<span class="nc" id="L1018">			}</span>
<span class="nc" id="L1019">		}</span>
<span class="nc" id="L1020">	}</span>

	public boolean gertaeraEzabatu(Event ev) {
<span class="fc" id="L1023">		Event event  = db.find(Event.class, ev); </span>
<span class="fc" id="L1024">		boolean resultB = true; </span>
<span class="fc" id="L1025">		List&lt;Question&gt; listQ = event.getQuestions(); </span>

<span class="pc bpc" id="L1027" title="1 of 2 branches missed.">		for(Question q : listQ) {</span>
<span class="nc bnc" id="L1028" title="All 2 branches missed.">			if(q.getResult() == null) {</span>
<span class="nc" id="L1029">				resultB = false; </span>
			}
<span class="nc" id="L1031">		}</span>
<span class="pc bpc" id="L1032" title="1 of 2 branches missed.">		if(resultB == false) {</span>
<span class="nc" id="L1033">			return false;</span>
<span class="fc bfc" id="L1034" title="All 2 branches covered.">		}else if(new Date().compareTo(event.getEventDate())&lt;0) {</span>
<span class="fc" id="L1035">			TypedQuery&lt;Quote&gt; Qquery = db.createQuery(&quot;SELECT q FROM Quote q WHERE q.getQuestion().getEvent().getEventNumber() =?1&quot;, Quote.class);</span>
<span class="fc" id="L1036">			Qquery.setParameter(1, event.getEventNumber()); </span>
<span class="fc" id="L1037">			List&lt;Quote&gt; listQUO = Qquery.getResultList();</span>
<span class="pc bpc" id="L1038" title="1 of 2 branches missed.">			for(int j=0; j&lt;listQUO.size(); j++) {</span>
<span class="nc" id="L1039">				Quote quo = db.find(Quote.class, listQUO.get(j));</span>
<span class="nc bnc" id="L1040" title="All 2 branches missed.">				for(int i=0; i&lt;quo.getApustuak().size(); i++) {</span>
<span class="nc" id="L1041">					ApustuAnitza apustuAnitza = quo.getApustuak().get(i).getApustuAnitza();</span>
<span class="nc" id="L1042">					ApustuAnitza ap1 = db.find(ApustuAnitza.class, apustuAnitza.getApustuAnitzaNumber());</span>
<span class="nc" id="L1043">					db.getTransaction().begin();</span>
<span class="nc" id="L1044">					ap1.removeApustua(quo.getApustuak().get(i));</span>
<span class="nc" id="L1045">					db.getTransaction().commit();</span>
<span class="nc bnc" id="L1046" title="All 4 branches missed.">					if(ap1.getApustuak().isEmpty() &amp;&amp; !ap1.getEgoera().equals(&quot;galduta&quot;)) {</span>
<span class="nc" id="L1047">						this.apustuaEzabatu(ap1.getUser(), ap1);</span>
<span class="nc bnc" id="L1048" title="All 4 branches missed.">					}else if(!ap1.getApustuak().isEmpty() &amp;&amp; ap1.irabazitaMarkatu()){</span>
<span class="nc" id="L1049">						this.ApustuaIrabazi(ap1);</span>
					}
<span class="nc" id="L1051">					db.getTransaction().begin();</span>
<span class="nc" id="L1052">					Sport spo =quo.getQuestion().getEvent().getSport();</span>
<span class="nc" id="L1053">					spo.setApustuKantitatea(spo.getApustuKantitatea()-1);</span>
<span class="nc" id="L1054">					db.getTransaction().commit();</span>
				}
			}

		}
<span class="fc" id="L1059">		db.getTransaction().begin();</span>
<span class="fc" id="L1060">		db.remove(event);</span>
<span class="fc" id="L1061">		db.getTransaction().commit();</span>
<span class="fc" id="L1062">		return true; </span>
	}

	public String saldoaBistaratu(Registered u) {
<span class="nc" id="L1066">		Registered reg = (Registered)db.find(Registered.class, u.getUsername());</span>
<span class="nc" id="L1067">		return reg.getDirukop().toString();</span>
	}

	/**
	 * Muestra en una lista los usuarios registrados de la aplicación ordenados de mayor a menor según el atributo &quot;irabazitakoa&quot;
	 * @return una lista con los usuarios registrados ordenados en base a lo qua han ganado
	 */
	public List&lt;Registered&gt; rankingLortu(){
<span class="fc" id="L1075">		TypedQuery&lt;Registered&gt; Rquery = db.createQuery(&quot;SELECT r FROM Registered r&quot;, Registered.class);</span>
<span class="fc" id="L1076">		List&lt;Registered&gt; listR = Rquery.getResultList();</span>
<span class="fc" id="L1077">		List&lt;Registered&gt; ema= new ArrayList&lt;Registered&gt;();</span>
		int i;
<span class="fc bfc" id="L1079" title="All 2 branches covered.">		for(Registered r: listR) {</span>
<span class="fc bfc" id="L1080" title="All 2 branches covered.">			if(ema.isEmpty()) {</span>
<span class="fc" id="L1081">				ema.add(0, r);</span>
			}else {
<span class="fc" id="L1083">				i=0;</span>
<span class="fc bfc" id="L1084" title="All 4 branches covered.">				while(i&lt;ema.size() &amp;&amp; r.getIrabazitakoa()&lt;ema.get(i).getIrabazitakoa()) {</span>
<span class="fc" id="L1085">					i++;</span>
				}
<span class="fc" id="L1087">				ema.add(i, r);</span>
			}
<span class="fc" id="L1089">		}</span>
<span class="fc" id="L1090">		return ema;</span>
	}

	public List&lt;Event&gt; getEventsAll() {	
<span class="nc" id="L1094">		TypedQuery&lt;Event&gt; query = db.createQuery(&quot;SELECT ev FROM Event ev &quot;,Event.class);   </span>
<span class="nc" id="L1095">		List&lt;Event&gt; events = query.getResultList();</span>
<span class="nc" id="L1096">		return events;</span>
	}

	/**
	 * Se copia un evento existente en una fecha dada
	 * @param parameterObject TODO
	 * @param parameterObject par�metros de entrada del m�todo (un evento y una fecha)
	 * @return devuelve true si se ha copiado con �xito el evento 'e' en la fecha 'date'.
	 */
	public boolean gertaerakKopiatu(GertaerakKopiatuParameter parameterObject) {
<span class="nc" id="L1106">		Boolean b=false;</span>
<span class="nc" id="L1107">		Event gertaera = db.find(Event.class, parameterObject.e.getEventNumber());</span>
<span class="nc" id="L1108">		db.getTransaction().begin();</span>


<span class="nc" id="L1111">		TypedQuery&lt;Event&gt; query = db.createQuery(&quot;SELECT ev FROM Event ev WHERE ev.getDescription()=?1 and ev.getEventDate()=?2&quot;,Event.class);   </span>
<span class="nc" id="L1112">		query.setParameter(1,gertaera.getDescription());</span>
<span class="nc" id="L1113">		query.setParameter(2, parameterObject.date);</span>
<span class="nc bnc" id="L1114" title="All 2 branches missed.">		if(query.getResultList().isEmpty()) {</span>
<span class="nc" id="L1115">			b=true;</span>
<span class="nc" id="L1116">			eventCopy(parameterObject.date, gertaera);</span>
		}
<span class="nc" id="L1118">		db.getTransaction().commit();</span>
<span class="nc" id="L1119">		return b;</span>
	}


	private void eventCopy(Date date, Event gertaera) {
<span class="nc" id="L1124">		String[] taldeak = gertaera.getDescription().split(&quot;-&quot;);</span>
<span class="nc" id="L1125">		Team lokala = new Team(taldeak[0]);</span>
<span class="nc" id="L1126">		Team kanpokoa = new Team(taldeak[1]);</span>
<span class="nc" id="L1127">		Event gertKopiatu = new Event(gertaera.getDescription(), date, lokala, kanpokoa);</span>
<span class="nc" id="L1128">		gertKopiatu.setSport(gertaera.getSport());</span>
<span class="nc" id="L1129">		gertaera.getSport().addEvent(gertKopiatu);</span>
<span class="nc" id="L1130">		db.persist(gertKopiatu);</span>
<span class="nc" id="L1131">		questionsCopy(gertaera, gertKopiatu);</span>
<span class="nc" id="L1132">	}</span>

	private void questionsCopy(Event gertaera, Event gertKopiatu) {
<span class="nc bnc" id="L1135" title="All 2 branches missed.">		for(Question q : gertaera.getQuestions()) {</span>
<span class="nc" id="L1136">			Question que= new Question(q.getQuestion(), q.getBetMinimum(), gertKopiatu);</span>
<span class="nc" id="L1137">			gertKopiatu.listaraGehitu(que);</span>
<span class="nc" id="L1138">			Question galdera = db.find(Question.class, q.getQuestionNumber());</span>
<span class="nc" id="L1139">			db.persist(que);</span>
<span class="nc" id="L1140">			quoteCopy(que, galdera);</span>
<span class="nc" id="L1141">		}</span>
<span class="nc" id="L1142">	}</span>

	private void quoteCopy(Question que, Question galdera) {
<span class="nc bnc" id="L1145" title="All 2 branches missed.">		for(Quote k: galdera.getQuotes()) {</span>
<span class="nc" id="L1146">			Quote kuo= new Quote(k.getQuote(), k.getForecast(), que);</span>
<span class="nc" id="L1147">			que.listaraGehitu(kuo);</span>
<span class="nc" id="L1148">			db.persist(kuo);</span>
<span class="nc" id="L1149">		}</span>
<span class="nc" id="L1150">	}</span>

	public boolean jarraitu(Registered jabea, Registered jarraitua, Double limit) {
<span class="nc" id="L1153">		Boolean b=false;</span>
<span class="nc" id="L1154">		Registered jarraitu = (Registered) db.find(Registered.class, jarraitua.getUsername());</span>
<span class="nc" id="L1155">		Registered harpideduna = (Registered) db.find(Registered.class, jabea.getUsername());</span>
<span class="nc bnc" id="L1156" title="All 2 branches missed.">		if(!harpideduna.getJarraitutakoLista().contains(jarraitu)) {</span>
<span class="nc" id="L1157">			db.getTransaction().begin();</span>
<span class="nc" id="L1158">			Jarraitzailea jar = new Jarraitzailea(harpideduna, jarraitu);</span>
<span class="nc" id="L1159">			harpideduna.addJarraitutako(jar);</span>
<span class="nc" id="L1160">			jarraitu.addJarraitzailea(jar);</span>
<span class="nc" id="L1161">			b=true;</span>
<span class="nc" id="L1162">			db.persist(jar);</span>
<span class="nc" id="L1163">			harpideduna.setDiruLimitea(limit);</span>
<span class="nc" id="L1164">			db.getTransaction().commit();</span>
		}
<span class="nc" id="L1166">		return b;</span>
	}


	public Sport popularrenaLortu() {
<span class="nc" id="L1171">		Integer max=Integer.MIN_VALUE;</span>
<span class="nc" id="L1172">		Sport s=null;</span>
<span class="nc" id="L1173">		TypedQuery&lt;Sport&gt; query = db.createQuery(&quot;SELECT sp FROM Sport sp &quot;,Sport.class);</span>
<span class="nc" id="L1174">		List&lt;Sport&gt;sp =query.getResultList();</span>
		Integer kont;
<span class="nc bnc" id="L1176" title="All 2 branches missed.">		for(Sport sport: sp) {</span>
<span class="nc" id="L1177">			kont=sport.getApustuKantitatea();</span>
<span class="nc bnc" id="L1178" title="All 2 branches missed.">			if(kont&gt;max) {</span>
<span class="nc" id="L1179">				s=sport;</span>
<span class="nc" id="L1180">				max=kont;</span>
			}
<span class="nc" id="L1182">		}</span>
<span class="nc" id="L1183">		return s;</span>
	}

	public void ezJarraituTaldea(Registered u) {
<span class="nc" id="L1187">		Registered r = (Registered) db.find(Registered.class, u.getUsername()); </span>
<span class="nc" id="L1188">		db.getTransaction().begin();</span>
<span class="nc" id="L1189">		Team t = db.find(Team.class, r.getTaldea());</span>
<span class="nc" id="L1190">		t.removeUser(r);</span>
<span class="nc" id="L1191">		r.setTaldea(null);</span>
<span class="nc" id="L1192">		db.getTransaction().commit();</span>
<span class="nc" id="L1193">	}</span>

	public List&lt;Team&gt; getAllTeams() {	
<span class="nc" id="L1196">		TypedQuery&lt;Team&gt; query = db.createQuery(&quot;SELECT t FROM Team t &quot;,Team.class);   </span>
<span class="nc" id="L1197">		List&lt;Team&gt; teams = query.getResultList();</span>
<span class="nc" id="L1198">		return teams;</span>
	}

	public void jarraituTaldea(Registered u, Team t) {
<span class="nc" id="L1202">		Registered r = (Registered) db.find(Registered.class, u.getUsername());</span>
<span class="nc" id="L1203">		Team team = db.find(Team.class, t.getIzena());</span>
<span class="nc" id="L1204">		db.getTransaction().begin();</span>
<span class="nc" id="L1205">		r.setTaldea(team);</span>
<span class="nc" id="L1206">		team.addUser(r);</span>
<span class="nc" id="L1207">		db.getTransaction().commit();</span>
<span class="nc" id="L1208">	}</span>

	public Registered findUser(Registered user){
<span class="nc" id="L1211">		return db.find(Registered.class, user.getUsername());</span>
	}

	public List&lt;Event&gt; getEventsTeam(Team team) {
<span class="nc" id="L1215">		Team t=db.find(Team.class, team.getIzena());</span>
<span class="nc" id="L1216">		TypedQuery&lt;Event&gt; query = db.createQuery(&quot;SELECT ev FROM Event ev WHERE ev.getLokala().getIzena()=?1 OR ev.getKanpokoa().getIzena()=?2&quot;,Event.class);</span>
<span class="nc" id="L1217">		query.setParameter(1, t.getIzena());</span>
<span class="nc" id="L1218">		query.setParameter(2, t.getIzena());</span>
<span class="nc" id="L1219">		return query.getResultList();</span>

	}
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.8.202204050719</span></div></body></html>